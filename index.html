<html>
<head>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<!-- style inspiration from https://mimno.github.io/showcase/project2/workforce/ -->
<style>
  .country{
    fill: none;
    /* stroke: black; */
  }
  .outline{
    stroke: white;
    stroke-width: 1px;
    fill: none;
  }
	form {
    margin: 0;
    padding: 0;
  }
	button.typeButton {
    border:1px solid #2166ac;
    padding: 10px;
    font-size: 18px;
    background-color: white;
    color: #2166ac;
    width: 130px;
    margin: 10px 15px 0 0;
  }
	button.typeButton:hover {
    background-color: black;
    color: #fff;
  }
	button.typeButtonOver {
    background-color: #4992c4;
    color: #fff;
  }

</style>

<body>
  <h1>World Happiness Visualization</h1>
  <h3>INFO 3300: Project 2</h3>
  <p id="header">Aileen Cai (ac952), Nate Schickler (njs59)</p>
  <p>Data is taken from <a href="https://www.kaggle.com/unsdsn/world-happiness/version/2?login=true">Kaggle</a></p>

<!-- buttons to select year -->
<form>
  <button id="2015" type="button" class="typeButton typeButtonOver">2015</button>
  <button id="2016" type="button" class="typeButton">2016</button>
  <button id="2017" type="button" class="typeButton">2017</button>
</form>


<!-- map of countries -->
<div id="2015_map">
  <svg class="happinessMap" id= "happinessMap2015" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2015"></svg>
</div>
<div id="2016_map">
  <svg class="happinessMap" id= "happinessMap2016" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2016"></svg>
</div>
<div id="2017_map">
  <svg class="happinessMap" id= "happinessMap2017" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2017"></svg>
</div>

</body>

<script>

 // hover over each country to get the following data: country name, happiness rank out of 158,and happiness score #
// TODO- CREATE TEXT WHEN HOVERING OVER COUNTRIES ***
 // TODO- CREATE LEGEND ***

 // TODO - 5????? SCATTERPLOTS ???? FOR Happiness vs (GDP, family size, health, freedom, and govt trust)
 // create a dropdown to select which variable to compare w happiness, color countries by its region


var height = 600;
var width = 1000;
var margin = { top: 20, right: 20, bottom: 20, left:20};
var mapHeight = height - margin.top - margin.bottom;
var mapWidth = width - margin.left - margin.right;

function yearCSV(year){
  d3.json("world-110m.json").then(function(world){
    d3.csv("data_worldHappiness/"+year+".csv").then(function(dataYear){
      d3.tsv("world-110m-country-names.tsv").then(function(countryID){
        var country_object = {}
        var idToCountry = {}
        countryID.forEach(row => {
          country_object[row.name] = 0;
          idToCountry[row.id] = row.name;
        });
        dataYear.forEach(row => {
          if (year == '2017'){
            country_object[row.Country] += row['Happiness.Score'];
          }
          else{
            country_object[row.Country] += row['Happiness Score'];
          }
        });
        // console.log(dataYear)
        // console.log(country_object)
        worldMapSVG(year, world, country_object, idToCountry);
      });
    });
  });
}

yearCSV("2015")
yearCSV("2016")
yearCSV("2017")


// make world map svg and color
function worldMapSVG(year, world, country_object, idToCountry){
  var countries = topojson.feature(world, world.objects.countries);
  var countriesMesh = topojson.mesh(world, world.objects.countries);
  var projection = d3.geoEqualEarth().fitSize([mapWidth, mapHeight],countries);
  var path = d3.geoPath().projection(projection);
  var svg = d3.select("svg#happinessMap" + year);
  var map = svg.append("g")
                  .attr("transform","translate("+margin.left+","+margin.top+")");
  map.selectAll("path").data(countries.features)
    .enter()
    .append("path")
    .attr("class","country")
    .attr("d",path);
  map.append("path")
    .datum(countriesMesh)
    .attr("class","outline")
    .attr("d",path);
    var colorScale = d3.scaleQuantile()
        .domain(d3.values(country_object))
        .range(["#c8ddf0","#4592c7","#1561a8","#08306b"]);
    map.selectAll(".country")
      .style('fill', function(d){
         return colorScale(country_object[idToCountry[d.id]]);
    });
}

// button-display year
document.getElementById("2015").onclick = function(){
  document.getElementById("2015_map").style.display = "block";
  document.getElementById("2016_map").style.display = "none";
  document.getElementById("2017_map").style.display = "none";
  document.getElementById("2015").className = "typeButton typeButtonOver";
	document.getElementById("2016").className = "typeButton";
	document.getElementById("2017").className = "typeButton";
}

document.getElementById("2016").onclick = function(){
  document.getElementById("2016_map").style.display = "block";
  document.getElementById("2015_map").style.display = "none";
  document.getElementById("2017_map").style.display = "none";
  document.getElementById("2016").className = "typeButton typeButtonOver";
	document.getElementById("2015").className = "typeButton";
	document.getElementById("2017").className = "typeButton";
}

document.getElementById("2017").onclick = function(){
  document.getElementById("2017_map").style.display = "block";
  document.getElementById("2015_map").style.display = "none";
  document.getElementById("2016_map").style.display = "none";
  document.getElementById("2017").className = "typeButton typeButtonOver";
	document.getElementById("2016").className = "typeButton";
	document.getElementById("2015").className = "typeButton";
}

</script>

</html>
