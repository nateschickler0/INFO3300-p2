<html>
<head>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<style>
  .country{
    fill: none;
    stroke: black;
  }
  .outline{
    stroke: black;
    stroke-width: 1px;
    fill:none;
  }
</style>

<body>
  <h1>World Happiness Visualization</h1>
  <h3>INFO 3300: Project 2</h3>
  <p id="header">Aileen Cai (ac952), Nate Schickler (njs59)</p>
  <p>Data is taken from <a href="https://www.kaggle.com/unsdsn/world-happiness/version/2?login=true">Kaggle</a></p>

<!-- map of countries -->
<div>
  <svg class="happinessMap" id= "happinessMap2015" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2015"  ></svg>
</div>
<div>
  <svg class="happinessMap" id= "happinessMap2016" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2016" ></svg>
</div>
<div>
  <svg class="happinessMap" id= "happinessMap2017" height = "600" width ="1000" ></svg>
  <svg class="legend" id= "legend2017" ></svg>
</div>

</body>

<script>
// TODO - MAKE MAP OF COUNTRIES - SEQUENTIAL COLOR SCHEME FOR LEVELS OF HAPPINESS.
 // hover over each country to get the following data: country name, happiness rank out of 158,and happiness score #

var height = 600;
var width = 1000;
var margin = { top: 20, right: 20, bottom: 20, left:20};
var mapHeight = height - margin.top - margin.bottom;
var mapWidth = width - margin.left - margin.right;

function yearCSV(year){
  d3.json("world-110m.json").then(function(world){

    d3.csv("data_worldHappiness/"+year+".csv").then(function(dataYear){
      d3.tsv("world-110m-country-names.tsv").then(function(countryID){
        var country_object = {}
        var idToCountry = {}
        countryID.forEach(row => {
          country_object[row.name] = 0;
          idToCountry[row.id] = row.name;
        });
        dataYear.forEach(row => {
          if (year == '2017'){
            country_object[row.Country] += row['Happiness.Score'];
          }
          else{
            country_object[row.Country] += row['Happiness Score'];
          }
        });
        console.log(dataYear)
        console.log(country_object)
        worldMapSVG(year, world, country_object, idToCountry);
      });
    });

  });

}
yearCSV("2015")
yearCSV("2016")
yearCSV("2017")

// make world map svg
function worldMapSVG(year, world, country_object, idToCountry){
  var countries = topojson.feature(world, world.objects.countries);
  var countriesMesh = topojson.mesh(world, world.objects.countries);
  var projection = d3.geoEqualEarth().fitSize([mapWidth, mapHeight],countries);
  var path = d3.geoPath().projection(projection);

  var svg = d3.select("svg#happinessMap" + year);
  var map = svg.append("g")
                  .attr("transform","translate("+margin.left+","+margin.top+")");
  map.selectAll("path").data(countries.features)
    .enter()
    .append("path")
    .attr("class","country")
    .attr("d",path);
  map.append("path")
    .datum(countriesMesh)
    .attr("class","outline")
    .attr("d",path);

    var colorScale = d3.scaleQuantile()
        .domain(d3.values(country_object))
        .range(["#eff6fc","#c8ddf0","#8abfdd","#4592c7","#1561a8","#08306b"]);
    map.selectAll(".country")
      .style('fill', function(d){
         return colorScale(country_object[idToCountry[d.id]]);
    });
}

// TODO- CREATE BUTTONS FOR YEARS (2015, 2016, 2017 )
// TODO- CREATE SCALE
// TODO- CREATE TEXT WHEN HOVERING OVER COUNTRIES
// TODO - 5????? SCATTERPLOTS ???? FOR Happiness vs (GDP, family size, health, freedom, and govt trust)
// create a dropdown to select which variable to compare w happiness, color countries by its region

</script>

</html>
